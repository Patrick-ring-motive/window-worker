<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>single thread test</title>
  </head>
  <body>

    
    <script>

    main();

      async function main(){
      let wj = await fetch('./winworker.js');
      let wjs=await wj.text();
      let crf = document.createElement('iframe');
      crf.setAttribute('readyId',new Date().getTime()); 
      crf.src = 'https://windowworker.github.io/worker/worker.html?'+encodeURIComponent(window.location.origin)+'?'+encodeURIComponent(crf.getAttribute('readyId'));
      document.body.appendChild(crf);
        
        
        
      window.addEventListener("message", (event) => {
        console.log(event);
          if (event.origin !== "https://windowworker.github.io")
       return;
        let rid = 'ready' + crf.getAttribute('readyId');
      if(event.data===rid){
      
        crf.contentWindow.postMessage(encodeURIComponent(wjs),'https://windowworker.github.io');
      
      }
      });
      }
      
      
      
    </script>
    

  </body>
</html>
